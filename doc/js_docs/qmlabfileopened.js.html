<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: qmlabfileopened.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: qmlabfileopened.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>///////////////////////
//qm_lab_file_opened //
///////////////////////
/**
 * Manages when a filed is opened in QM Lab
 * @class qm_lab_file_opened
 */

/**
 * The first time the collaborative diagramming document is ever run, it will
 *   run this initialization function. It will create an empty collaborative
 *   graph, and add it to Google's Collaborative Map.
 * @preconditions Google Realtime API has never seen the current document ID. No
 *   graph has been initialzed for this document. If one has, this function will
 *   override it.
 * @postconditions There will be an empty graph in Google's Realtime API, stored
 *   at key "graph". colGraph: Local access to the collaborative graph.
 * @param  {model} model The model of the Google Realtime API which the document
 *   works on.
 * @memberOf qm_lab_file_opened
 */
function onFileInitialize(model) {
	rootModel = model;

	var cGraph = model.create('CollaborativeGraph');
	model.getRoot().set("graph", cGraph);
	colGraph = model.getRoot().get('graph');
	initializeGraph();
	initializePrintGraph();
	console.log("Initialize complete");

	updateGraph();
}

/**
 * This function is run every time the document is loaded by Google Realtime
 *   API. It generates the diagram graph from the collaborative map, and saves
 *   access to Google's Collaborative Objects map. It sets up the event
 *   listeners on all existing "cells" to update their respective collaborative
 *   objects whenever they change. Also, it adds event listeners to update the
 *   back-up graph whever the user finishes interaction with the diagram.
 * @param  {collaDoc} doc The Google Drive document that stores the
 *   collaborative model.
 * @preconditions The document has been loaded. If Google Realtime API hasn't
 *   given access, this function will crash the page. You have been warned.
 * @postconditions The diagram has been updated to the collaborative graph.
 *   Event listeners have been added to the diagram to allow user interaction
 *   and realtime updating. rootModel: local access to the Google Realtime API.
 *   realDoc: local access that allows getting the collaborators currently
 *   working on the document. colGraph: local access back-up graph
 * @memberOf qm_lab_file_opened
 */
function onFileLoaded(doc) {
	genUI.genUI(); // function loads the toolbars and menus required for the user interface
			// function is declared in genUI.js
	
	graph = new joint.dia.Graph;
	printGraph = new joint.dia.Graph; //Initialize the graph for printing
	rootModel = doc.getModel();
	realDoc = doc;
	colGraph = rootModel.getRoot().get('graph');
	initializePaper();
	initializePrintPaper();  //Initialize the paper for printing


	// Update the collaborative object whenever the user finishes making a change
	paper.on('cell:pointerup', updateCollabGraph);
	paper.on('blank:pointerup', updateCollabGraph);

	updateGraph();

	addGlobalEventListeners();

	addCollabEventToAllCells();
	allowCollabRecording();
	
	clearLoadingScreen();
	
	console.log("We loaded the document.");
}

/**
 * This function adds neccesary event listeners to the html document itself,
 *   giving a generic handler function to decide what to do with the event from
 *   there. These include: when the mouse, moves when a key on the keyboard is
 *   pressed.
 * @preconditions the html document has been loaded.
 * @postconditions the html document has global event listeners waiting for user
 *   input.
 * @memberOf qm_lab_file_opened
 */
function addGlobalEventListeners() {
	document.addEventListener('keydown', handleKeyInput);
	document.addEventListener('mousemove', handleMouseMove);
}

/**
 * This function grabs all local cells currently in a the graph, then adds event
 *   listeners to them that will ensures they updates their collaborative
 *   counterparts.
 * @preconditions The local graph must exist.
 * @postconditions Any local cell contained by the local graph will have had an
 *   event listener attached. To itself that will make it update its
 *   collaborative counterpart on change.
 * @memberOf qm_lab_file_opened
 */
function addCollabEventToAllCells() {
	var cells = graph.getCells();
	for (i = 0; i &lt; cells.length; i++) {
		addCollabEventToCell(cells[i]);
	}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="cell_parent_logic.html">cell_parent_logic</a></li><li><a href="check_collab_allowed.html">check_collab_allowed</a></li><li><a href="collab_object_setup.html">collab_object_setup</a></li><li><a href="connection_check.html">connection_check</a></li><li><a href="create_objects.html">create_objects</a></li><li><a href="element_prop_alter.html">element_prop_alter</a></li><li><a href="g_r_api_auth.html">g_r_api_auth</a></li><li><a href="initialize_diagram.html">initialize_diagram</a></li><li><a href="initialize_web_page.html">initialize_web_page</a></li><li><a href="link_joining.html">link_joining</a></li><li><a href="loading_bar.html">loading_bar</a></li><li><a href="qm_lab_file_opened.html">qm_lab_file_opened</a></li><li><a href="qm_lab_joint_classes.html">qm_lab_joint_classes</a></li><li><a href="utility_functions_qm_lab.html">utility_functions_qm_lab</a></li></ul><h3>Global</h3><ul><li><a href="global.html#setPropertyDisplayValues">setPropertyDisplayValues</a></li><li><a href="global.html#updateProperties">updateProperties</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Apr 04 2016 21:32:08 GMT-0600 (Canada Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
